<!DOCTYPE html>
<html lang="en" ng-app="myApp">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Gaming Platform</title>
  <meta name="description" content="Gaming Platform for games using GameApi">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular-route.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.2.26/angular-animate.js"></script>
  <script src="ui-bootstrap-tpls-0.11.2.min.js"></script>
  <script src="fblogin.js"></script>
  <script src="views.js"></script>
  <script src="platformMessageService.js"></script>
  <script src="platformScaleService.js"></script>
  <script src="interComService.js"></script>
  <script src="stateService.js"></script>
  <script src="http://yoav-zibin.github.io/emulator/serverApiService.js"></script>
  <link rel="stylesheet" type="text/css" href="bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="platform.css" />
    <script type="text/javascript">
      function makeAjaxCall(url, callback) {
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function() {
      if (xmlhttp.readyState==4 && xmlhttp.status==200) {
        var responseText = xmlhttp.responseText;
        console.log(responseText);
        callback(responseText);
      }
    };
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
  }

  function sendMessageToPhonegap(message) {
    alert("sendMessageToPhonegap:" + message);
    window.parent.postMessage(message, "*");
  }

  function testFbAPI(access_token) {
    makeAjaxCall(
      "https://graph.facebook.com/v2.2/me?format=json&method=get&pretty=0&suppress_http_code=1&access_token="
        + access_token,
      function(responseText) {
        var response = JSON.parse(responseText);
        alert('Successful login for: ' + response.name);
      }
    );
  }

  window.addEventListener("message", function (event) {
    var message = event.data;
    var source = event.source;
    if (source === window.parent) {
      alert("platform got message:" + JSON.stringify(message));
      if (message.token) {
        testFbAPI(message.token);
      }
    }
  }, false);

  makeAjaxCall("phonegapIframe_phonegapCode.js",
    function(responseText) {
      alert('Loaded phonegapIframe_phonegapCode.js: ' + responseText);
      sendMessageToPhonegap(responseText);
    }
  );
    angular.element(document.getElementsByTagName('head')).append(angular.element('<base href="' + window.location.pathname + '" />'));
  </script>
</head>
<body class="platformBackground" style="height:100%; width:100%; overflow: hidden;"
    ng-cloak>
  	<div ng-controller="routeCtrl" id="gameContent" class="slowlyAppear">
  		<div>
      		<div ng-view ng-class="animationStyle" style="position:absolute;height:100%; width:100%;"></div>
      	</div>
    </div>
</body>
</html>
